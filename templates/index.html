<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartTalk AI | The Ultimate Excuse Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; }
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .gradient-text {
            background: linear-gradient(to right, #38bdf8, #818cf8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    </style>
</head>
<body class="text-gray-100 min-h-screen flex flex-col items-center justify-center p-4">

    <header class="text-center mb-8">
        <h1 class="text-4xl md:text-5xl font-bold mb-2 tracking-tight">
            SmartTalk <span class="gradient-text">AI</span>
        </h1>
        <p class="text-gray-400 text-sm md:text-base">Speak right to anyone. No stress, just results.</p>
    </header>

    <div class="w-full max-w-4xl grid grid-cols-1 lg:grid-cols-2 gap-6">
        
        <div class="glass-panel p-6 rounded-2xl shadow-xl">
            <h2 class="text-xl font-semibold mb-4 text-sky-400 border-b border-gray-700 pb-2">
                <i class="fa-solid fa-sliders mr-2"></i>Customize It
            </h2>
            
            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-medium text-gray-400 mb-1">I am a...</label>
                        <select id="sender" onchange="toggleCustom('sender')" class="w-full bg-slate-800 border border-slate-600 rounded-lg p-2.5 text-sm focus:ring-2 focus:ring-sky-500 outline-none transition">
                            <option>Student</option><option>Employee</option><option>Boss</option>
                            <option>Boyfriend</option><option>Girlfriend</option><option>Sibling</option>
                            <option>Freelancer</option><option>Other</option>
                        </select>
                        <input id="sender_custom" placeholder="Specify role..." class="hidden mt-2 w-full bg-slate-900 border border-slate-700 rounded-lg p-2 text-sm text-sky-300">
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-400 mb-1">Talking to...</label>
                        <select id="receiver" onchange="toggleCustom('receiver')" class="w-full bg-slate-800 border border-slate-600 rounded-lg p-2.5 text-sm focus:ring-2 focus:ring-sky-500 outline-none transition">
                            <option>Teacher</option><option>Boss</option><option>Client</option>
                            <option>Parent</option><option>Partner</option><option>Friend</option>
                            <option>Landlord</option><option>Other</option>
                        </select>
                        <input id="receiver_custom" placeholder="Specify role..." class="hidden mt-2 w-full bg-slate-900 border border-slate-700 rounded-lg p-2 text-sm text-sky-300">
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-medium text-gray-400 mb-1">Vibe / Tone</label>
                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="selectTone(this, 'Polite')" class="tone-btn bg-slate-800 py-2 rounded-lg text-xs hover:bg-slate-700 border border-slate-600 transition">Polite</button>
                        <button onclick="selectTone(this, 'Funny')" class="tone-btn bg-slate-800 py-2 rounded-lg text-xs hover:bg-slate-700 border border-slate-600 transition">Funny</button>
                        <button onclick="selectTone(this, 'Dramatic')" class="tone-btn bg-slate-800 py-2 rounded-lg text-xs hover:bg-slate-700 border border-slate-600 transition">Dramatic</button>
                        <button onclick="selectTone(this, 'Professional')" class="tone-btn bg-slate-800 py-2 rounded-lg text-xs hover:bg-slate-700 border border-slate-600 transition">Pro</button>
                        <button onclick="selectTone(this, 'Apologetic')" class="tone-btn bg-slate-800 py-2 rounded-lg text-xs hover:bg-slate-700 border border-slate-600 transition">Sorry</button>
                        <button onclick="selectTone(this, 'Firm')" class="tone-btn bg-slate-800 py-2 rounded-lg text-xs hover:bg-slate-700 border border-slate-600 transition">Firm</button>
                    </div>
                    <input type="hidden" id="tone" value="Polite">
                </div>

                <div>
                    <label class="block text-xs font-medium text-gray-400 mb-1">What's happening?</label>
                    <textarea id="situation" rows="3" class="w-full bg-slate-800 border border-slate-600 rounded-lg p-3 text-sm focus:ring-2 focus:ring-sky-500 outline-none" placeholder="e.g. I missed the deadline because my cat ate the wifi router..."></textarea>
                </div>

                <div>
                    <label class="block text-xs font-medium text-gray-400 mb-1">Any Secret Details? (Optional)</label>
                    <textarea id="extra" rows="2" class="w-full bg-slate-800 border border-slate-600 rounded-lg p-3 text-sm focus:ring-2 focus:ring-sky-500 outline-none" placeholder="e.g. Mention that I will treat them to coffee."></textarea>
                </div>

                <button onclick="generate()" class="w-full bg-gradient-to-r from-sky-500 to-blue-600 hover:from-sky-400 hover:to-blue-500 text-white font-bold py-3 rounded-lg shadow-lg transform transition active:scale-95 flex justify-center items-center gap-2">
                    <span id="btn-text">Generate Magic</span>
                    <i id="btn-icon" class="fa-solid fa-wand-magic-sparkles"></i>
                    <i id="loading-spinner" class="fa-solid fa-circle-notch fa-spin hidden"></i>
                </button>
            </div>
        </div>

        <div class="glass-panel p-6 rounded-2xl shadow-xl flex flex-col h-full relative">
            <h2 class="text-xl font-semibold mb-4 text-purple-400 border-b border-gray-700 pb-2">
                <i class="fa-solid fa-message mr-2"></i>Your Message
            </h2>
            
            <div id="output-container" class="flex-grow flex items-center justify-center bg-slate-900/50 rounded-xl p-6 border border-slate-700/50 min-h-[300px]">
                <p class="text-gray-500 text-center italic" id="placeholder-text">
                    "Waiting for your brilliant inputs..."
                </p>
                <div id="result-text" class="hidden text-gray-100 text-lg leading-relaxed whitespace-pre-line text-left w-full"></div>
            </div>

            <div id="actions" class="mt-4 grid grid-cols-2 gap-3 hidden">
                <button onclick="copyText()" class="bg-slate-700 hover:bg-slate-600 text-white py-2 rounded-lg transition flex items-center justify-center gap-2">
                    <i class="fa-regular fa-copy"></i> Copy
                </button>
                <button onclick="downloadPDF()" class="bg-slate-700 hover:bg-slate-600 text-white py-2 rounded-lg transition flex items-center justify-center gap-2">
                    <i class="fa-regular fa-file-pdf"></i> Save PDF
                </button>
            </div>
        </div>
    </div>

    <footer class="mt-12 text-gray-500 text-xs">
        Powered by <span class="text-gray-300">Gemini AI</span> & Built for Fun
    </footer>

    <script>
        // Handle Tone Selection Styling
        function selectTone(btn, value) {
            document.querySelectorAll('.tone-btn').forEach(b => {
                b.classList.remove('bg-sky-600', 'text-white', 'border-sky-500');
                b.classList.add('bg-slate-800', 'border-slate-600');
            });
            btn.classList.remove('bg-slate-800', 'border-slate-600');
            btn.classList.add('bg-sky-600', 'text-white', 'border-sky-500');
            document.getElementById('tone').value = value;
        }

        // Initialize first tone
        document.querySelector('.tone-btn').click();

        // Handle "Other" inputs
        function toggleCustom(id) {
            const select = document.getElementById(id);
            const custom = document.getElementById(id + "_custom");
            if (select.value === "Other") {
                custom.classList.remove("hidden");
            } else {
                custom.classList.add("hidden");
            }
        }

        // Generate Function
        function generate() {
            const btnText = document.getElementById('btn-text');
            const btnIcon = document.getElementById('btn-icon');
            const spinner = document.getElementById('loading-spinner');
            const outputContainer = document.getElementById('output-container');
            const resultText = document.getElementById('result-text');
            const placeholder = document.getElementById('placeholder-text');
            const actions = document.getElementById('actions');

            // Loading State
            btnText.innerText = "Generating...";
            btnIcon.classList.add('hidden');
            spinner.classList.remove('hidden');
            actions.classList.add('hidden');
            
            fetch("/generate", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    sender: document.getElementById('sender').value,
                    receiver: document.getElementById('receiver').value,
                    sender_custom: document.getElementById('sender_custom').value,
                    receiver_custom: document.getElementById('receiver_custom').value,
                    situation: document.getElementById('situation').value,
                    tone: document.getElementById('tone').value,
                    extra: document.getElementById('extra').value
                })
            })
            .then(res => res.json())
            .then(data => {
                // Reset State
                btnText.innerText = "Generate Magic";
                btnIcon.classList.remove('hidden');
                spinner.classList.add('hidden');

                // Show Result
                placeholder.classList.add('hidden');
                resultText.classList.remove('hidden');
                resultText.innerText = data.reply;
                actions.classList.remove('hidden');
            })
            .catch(err => {
                console.error(err);
                btnText.innerText = "Error - Try Again";
                spinner.classList.add('hidden');
            });
        }

        // Copy to Clipboard
        function copyText() {
            const text = document.getElementById('result-text').innerText;
            navigator.clipboard.writeText(text).then(() => {
                alert("Message copied!");
            });
        }

        // Download PDF
        function downloadPDF() {
            const element = document.getElementById('result-text');
            const opt = {
                margin:       1,
                filename:     'SmartTalk_Message.pdf',
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 2 },
                jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
            };
            // Simple visual tweak for PDF
            let originalColor = element.style.color;
            element.style.color = "black"; // Make text black for PDF
            
            html2pdf().set(opt).from(element).save().then(() => {
                element.style.color = originalColor; // Revert color
            });
        }
    </script>
</body>
</html>